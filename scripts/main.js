window.sbc2={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";new sbc2.Views.AppView({el:$(".container"),model:new sbc2.Models.AppModel})},convert_server:"http://54.201.8.173/"},$(document).ready(function(){"use strict";sbc2.init()}),sbc2.Models=sbc2.Models||{},function(){"use strict";sbc2.Models.AppModel=Backbone.Model.extend({initialize:function(){this.set({user:new sbc2.Models.UserModel}),this.get("user").on("login",function(){this.initializeRouter(),this.initializeModels()},this)},initializeRouter:function(){var e=this,i=Backbone.Router.extend({navigate:function(i){switch(i){case"logout":e.logout();break;case"pdf":e.pdf();break;case"word":e.word();break;case"changepass":break;case"clear":e.clearDocument();break;default:e.navigate(i)}}});this.set({router:new i}),Backbone.history.start({})},initializeModels:function(){this.set({document:new sbc2.Models.DocumentModel({},{firebase:new Firebase("https://sbc.firebaseio.com/"+this.get("user").toJSON().id)})})},navigate:function(e){this.trigger("navigate",e)},logout:function(){this.get("user").logout(),window.location.reload()},clearDocument:function(){},pdf:function(){this.trigger("download","pdf")},word:function(){this.trigger("download","word")}})}(),sbc2.Views=sbc2.Views||{},function(){"use strict";sbc2.Views.AppView=Backbone.View.extend({initialize:function(){this.authorize(),this.$pdfGenerateButton=$("a[href$=pdf]"),this.$wordGenerateButton=$("a[href$=word]"),this.$pdfFetchButton=$("a[href$=pdf_fetch]"),this.$wordFetchButton=$("a[href$=word_fetch]"),this.$clearButton=$("#resetDocument"),$('[data-toggle="tooltip"]').tooltip({placement:"right",trigger:"click"}),this.$sidebar=$(".sidebar"),this.hashFragment=""},authorize:function(){this.userView=new sbc2.Views.UserView({el:$(".user"),model:this.model.get("user")}),this.model.get("user").on("login",function(){$(".main").removeClass("hidden"),this.userView.remove(),this.initializeEvents(),this.initializeViews(),this.checkConvertServer(),this.render()},this)},checkConvertServer:function(){var e=this;e.$pdfGenerateButton.html(""),e.$wordGenerateButton.html(""),$.get(sbc2.convert_server,function(i){i.ping===!0&&(e.$pdfGenerateButton.html('<i class="fa fa-cloud-download"></i> Pdf generate'),e.$wordGenerateButton.html('<i class="fa fa-cloud-download"></i> Word generate'))})},render:function(){this.$sidebar.removeClass("hidden")},navigate:function(e){"word_fetch"!==e&&"pdf_fetch"!==e&&($("#"+this.hashFragment).addClass("hidden"),this.hashFragment=e,$("#"+this.hashFragment).removeClass("hidden"))},initializeEvents:function(){var e=this;this.$pdfFetchButton.on("click",function(i){e.fetchFile(i)}),this.$wordFetchButton.on("click",function(i){e.fetchFile(i)}),this.$sidebar.find("a").on("click",function(i){e.sidebarLinkClick(i)}),this.$clearButton.click(function(){e.sidebarClearClick()}),this.model.on("navigate",function(e){this.navigate(e)},this),this.model.on("download",function(e){this.fileConvertRequest(e)},this),this.model.on("clear",function(){this.sidebarClearClick()},this)},initializeViews:function(){this.model.set({documentView:new sbc2.Views.DocumentView({model:this.model.get("document"),el:$(".main")})}),""===window.location.hash&&this.model.get("router").navigate("companydetails")},sidebarLinkClick:function(e){e.preventDefault();var i=e.target.hash.slice(1);this.model.get("router").navigate(i,{trigger:!0})},sidebarClearClick:function(){this.model.get("document").reset()},fileConvertRequest:_.debounce(function(e){this.beforeRequest(e);var i=this;$.ajax({type:"POST",url:sbc2.convert_server+e+"_convert",data:{id:i.model.get("user").toJSON().id},success:function(t){t.success===!0?i.convertSuccess(e):i.convertError(e,t.error)},error:function(){i.convertError(e,success.error)}})},500,!0),beforeRequest:function(e){var i=$("a[href$="+e+"]");this.$wordGenerateButton.html('<i class="fa fa-cloud-download"></i> Word generate'),this.originalHtml=i.html(),i.html('<i class="fa fa-spin fa-spinner"></i> This might take a sec.')},convertSuccess:function(e){console.log(e);var i=$("a[href$="+e+"]"),t=$("a[href$="+e+"_fetch]");i.html(this.originalHtml),i.addClass("hidden"),t.removeClass("hidden"),this.fetchType=e},fetchFile:function(e){if(e.stopPropagation(),e.preventDefault(),this.fetchType){window.location=sbc2.convert_server+this.fetchType+"/"+this.model.get("user").toJSON().id;var i=$("a[href$="+this.fetchType+"]"),t=$("a[href$="+this.fetchType+"_fetch]");return i.html(this.originalHtml),i.removeClass("hidden"),t.addClass("hidden"),!1}},convertError:function(e,i){var t=$("a[href$="+e+"]");t.html(i)}})}(),sbc2.Views=sbc2.Views||{},function(){"use strict";sbc2.Views.UserView=Backbone.View.extend({initialize:function(){this.$login=$(".login"),this.$changepasseword=$("a[href$=changepass]"),this.$blanket=$(".blanket"),this.model.on("needLogin",function(){this.initializeViews()},this);var e=this;this.$changepasseword.click(function(){e.model.changePass()}),this.model.initializer()},initializeViews:function(){this.$blanket.addClass("hidden"),this.$login.removeClass("hidden"),$(".copy").removeClass("hidden"),this.loginView=new sbc2.Views.LoginView({el:$(".login"),model:this.model}),this.signupView=new sbc2.Views.SignupView({el:$(".signup"),model:this.model}),this.loginView.on("changePage",function(){this.loginView.hide(),this.signupView.show()},this),this.signupView.on("changePage",function(){this.signupView.hide(),this.loginView.show()},this)},remove:function(){$(this.el).remove()}})}(),sbc2.Views=sbc2.Views||{},function(){"use strict";sbc2.Views.SignupView=Backbone.View.extend({initialize:function(){this.render()},render:function(){this.$form=$(this.el).find("form"),this.$link=$(".login-link"),this.$email=$(this.el).find("#inputEmail"),this.$password=$(this.el).find("#inputPassword"),this.$rememberMe=$(this.el).find("#rememberMe"),this.$flash=$(this.el).find("#flash"),this.$icon=$(this.el).find(".icon-spinner");var e=this;this.$link.click(function(i){i.preventDefault(),e.trigger("changePage")}),this.$form.submit(function(i){e.submit(i)}),this.model.on("login",function(){this.hide()},this)},submit:function(e){e.preventDefault(),this.$icon.removeClass("hidden"),this.model.set({email:this.$email.val()}),this.model.set({password:this.$password.val()}),this.model.set({rememberMe:this.$rememberMe.is(":checked")});var i=this;this.$flash.hide(),this.model.signup(function(e){i.$icon.addClass("hidden"),i.$flash.html(e.code).show()})},show:function(){$(this.el).removeClass("hidden")},hide:function(){$(this.el).addClass("hidden")}})}(),sbc2.Views=sbc2.Views||{},function(){"use strict";sbc2.Views.LoginView=Backbone.View.extend({initialize:function(){this.render()},render:function(){this.$form=$(this.el).find("form"),this.$link=$(".signup-link"),this.$resetLink=$(".reset-link"),this.$email=$(this.el).find("#inputEmail"),this.$password=$(this.el).find("#inputPassword"),this.$rememberMe=$(this.el).find("#rememberMe"),this.$flash=$(this.el).find("#flash"),this.$icon=$(this.el).find("i");var e=this;this.$link.click(function(i){i.preventDefault(),e.trigger("changePage")}),this.$form.submit(function(i){e.submit(i)}),this.$resetLink.click(function(i){i.preventDefault(),e.resetPassword()}),this.model.on("loginFailed",function(e){this.submitCallback(e)},this),this.model.on("login",function(){this.hide()},this)},submit:function(e){e.preventDefault(),this.$icon.removeClass("hidden"),this.model.set({email:this.$email.val()}),this.model.set({password:this.$password.val()}),this.model.set({rememberMe:this.$rememberMe.is(":checked")}),this.$flash.hide(),this.model.login()},submitCallback:function(e){this.$icon.addClass("hidden"),this.$flash.html(e.code).show()},show:function(){$(this.el).removeClass("hidden")},hide:function(){$(this.el).addClass("hidden")},resetPassword:function(){this.model.reset()}})}(),sbc2.Models=sbc2.Models||{},function(){"use strict";sbc2.Models.UserModel=Backbone.Model.extend({initializer:function(){var e=this;this.firebase=new Firebase("https://sbc.firebaseio.com/"),this.auth=new FirebaseSimpleLogin(this.firebase,function(i,t){e.handleAuth(i,t)}),window.user=this},handleAuth:function(e,i){e?this.trigger("loginFailed",e):i?(this.set({id:i.id}),this.set({provider:i.provider}),this.set({firebaseAuthToken:i.firebaseAuthToken}),this.set({md5_hash:i.md5_hash}),this.set({uid:i.uid}),this.set({email:i.email}),this.trigger("login")):this.trigger("needLogin")},login:function(){this.auth.login("password",{email:this.get("email"),password:this.get("password"),rememberMe:this.get("rememberMe")})},logout:function(){this.auth.logout(),window.location.reload()},signup:function(e){var i=this;this.auth.createUser(this.get("email"),this.get("password"),function(t){t&&e(t),t||i.login()})},reset:function(){var e=prompt("What is your email?");e&&this.auth.sendPasswordResetEmail(e,function(e){e?e?"INVALID_EMAIL"===e.code&&alert("That email is not tied to an account."):alert("Somethings gone wrong, try again."):alert("Password reset email sent.")})},changePass:function(){var e=prompt("Enter current password");if(e){var i=prompt("Enter new password");i&&this.auth.changePassword(this.get("email"),e,i,function(e,i){console.log(e,i),e?alert("INVALID_PASSWORD"===e.code?"Entered current password incorrectly":"Somethings gone wrong, try again."):(alert("Password changed successfully"),location.reload())})}}})}(),sbc2.Views=sbc2.Views||{},function(){"use strict";sbc2.Views.DocumentView=Backbone.View.extend({model:sbc2.Models.DocumentModel,initialize:function(){this.render(),this.initializeEvents()},render:function(){_.each(this.model.toJSON(),function(e,i){$(this.el).find("#"+i).val(e.value)},this),_.each(this.model.get("superheaders"),function(e,i){e.active===!0?$("#"+i).find(".btn-group > .enabler").button("toggle"):$("#"+i).find(".btn-group > .disabler").button("toggle")})},initializeEvents:function(){var e=this;$(this.el).find("input").on("keyup",function(i){e.handleItemChange(i.target.id,i.target.value)}),$(this.el).find("textarea").on("keyup",function(i){e.handleItemChange(i.target.id,i.target.value)}),$(this.el).find(".selectbox").on("change",function(){e.handleItemChange("currency",$(".selectbox option:selected").val())}),$(this.el).find(".enabler").on("click",function(i){e.toggleSuperHeader(i,!0)}),$(this.el).find(".disabler").on("click",function(i){e.toggleSuperHeader(i,!1)}),this.model.once("fetch",function(){this.render()},this),this.model.once("reset",function(){this.render()},this)},sanitize:function(e){return e.replace(/\u20ac/g,"E")},handleItemChange:function(e,i){$(".sidebar .flash").show().html('<i class="fa fa-spinner fa-spin"></i> Saving.').fadeOut("slow"),i=this.sanitize(i),this.model.get(e).value=i,this.model.save()},toggleSuperHeader:function(e,i){var t=$(e.target).parent().parent().attr("id");this.model.get("superheaders")[t].active=i,this.model.save()}})}(),sbc2.Models=sbc2.Models||{},function(){"use strict";sbc2.Models.DocumentModel=Backbone.Model.extend({defaults:{businessname:{value:"",active:!0},yourname:{value:"",active:!0},yourphonenumber:{value:"",active:!0},youremail:{value:"",active:!0},street1:{value:"",active:!0},street2:{value:"",active:!0},town:{value:"",active:!0},county:{value:"",active:!0},ceoname:{value:"",active:!0},profile1:{value:"",active:!0},profile2:{value:"",active:!0},profile3:{value:"",active:!0},profile4:{value:"",active:!0},website:{value:"",active:!0},industrysector:{value:"",active:!0},yearestablished:{value:"",active:!0},currentfinancialyear:{value:"",active:!0},currency:{value:"",active:!0},mostrecent2:{value:"",active:!0},mostrecent:{value:"",active:!0},nextyear1:{value:"",active:!0},nextyear2:{value:"",active:!0},nextyear3:{value:"",active:!0},vision:{value:"",active:!0},milestones:{value:"",active:!0},targets:{value:"",active:!0},purpose:{value:"",active:!0},passion:{value:"",active:!0},guidingprinciples:{value:"",active:!0},positioning:{value:"",active:!0},resources:{value:"",active:!0},purposeofplan:{value:"",active:!0},productsservicesandbenifits:{value:"",active:!0},marketopportunity:{value:"",active:!0},aboutyourbusiness:{value:"",active:!0},businessmodel:{value:"",active:!0},visionandmission:{value:"",active:!0},managmentteam:{value:"",active:!0},describeyourproduct:{value:"",active:!0},marketoverview:{value:"",active:!0},marketneeds:{value:"",active:!0},keycustomers:{value:"",active:!0},benifittocustomers:{value:"",active:!0},competitors:{value:"",active:!0},marketingoverview:{value:"",active:!0},pricing:{value:"",active:!0},promotion:{value:"",active:!0},salesplan:{value:"",active:!0},competitiveedge:{value:"",active:!0},strengths:{value:"",active:!0},weaknesses:{value:"",active:!0},opportunities:{value:"",active:!0},threats:{value:"",active:!0},distributionstrategy:{value:"",active:!0},roadmap:{value:"",active:!0},randd:{value:"",active:!0},copyrightspatents:{value:"",active:!0},employees:{value:"",active:!0},locationsandfacilities:{value:"",active:!0},managmentstructure:{value:"",active:!0},technology:{value:"",active:!0},superheaders:{companydetails:{active:!0},executivesummary:{active:!0},strategy:{active:!0},businessdescription:{active:!0},managmentteamsuper:{active:!0},productsandservices:{active:!0},targetmarket:{active:!0},marketingplan:{active:!0},researchanddevelopment:{active:!0},operationsandemployment:{active:!0},financialplan:{active:!0}}},initialize:function(e,i){var t=this;this.firebase=i.firebase,this.firebase.on("value",function(e){t.set(e.val()),t.trigger("fetch")})},save:function(){this.firebase.set(this.toJSON())},reset:function(){this.clear().set(this.defaults),this.trigger("reset"),this.save()}})}();